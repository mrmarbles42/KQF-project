fruit_cig <- fread(here("data/base_files", "cig_yield_bloom.csv"))
View(fruit_cig)
##import latewater control data
lw_ctrl_cig <- fread(here("data", "2021_cig_latewater_controls.csv"))
#Decas pest data 2011-2018----
pest_decas <- fread(here("data/base_files","pest_use_decas.csv"))
View(pest_decas)
View(pest_decas)
View(fruit_decas)
View(pest_decas)
View(fruit_cig)
pest_cig <- fread(here("data/base_files", "pest_use_cig.csv"))
View(pest_cig)
View(pest_cig)
dim(pest_decas)
#climate parameters 2003-2020----
temp_precip <- fread(here("data/base_files", "kqf_temp_precip.csv"))
View(temp_precip)
View(temp_precip)
#kqf points----
points <- fread(here("data/base_files", "kqf_points.csv"))
View(points)
##date manipulation
fruit_decas$date <- parse_date_time(fruit_decas$date, "mdy")
class(fruit_decas$date)
fruit_decas <- fruit_decas %>%
select(grower_id,
deliver_date,
Bog,
Rot,
Debris,
Color,
Variety)
source(here("code", "kqf_import.R"))
##date manipulation
fruit_decas$date <- parse_date_time(fruit_decas$date, "mdy")
##collapsed varieties vector
other_varieties = c("OE","ORST","OH",
"OM","GR","OB",
"SN","MC","SK",
"ORHO","OS","MX",
"GD","PD")
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date) %>%
##rename columns
rename("grower" = "grower_id",
"rot_pct" = "rot")
source(here("code", "kqf_import.R"))
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date) %>%
##rename columns
rename("grower" = "grower_id",
"rot_pct" = "rot")
##date manipulation
fruit_decas$date <- parse_date_time(fruit_decas$date, "mdy")
##collapsed varieties vector
other_varieties = c("OE","ORST","OH",
"OM","GR","OB",
"SN","MC","SK",
"ORHO","OS","MX",
"GD","PD")
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date) %>%
##rename columns
rename("grower" = "grower_id",
"rot_pct" = "rot")
View(fruit_decas)
fruit_12 <- fread(here("data/base_files","grower_yield_rpt_2012.csv"))
fruit_13 <- fread(here("data/base_files","grower_yield_rpt_2013.csv"))
fruit_14 <- fread(here("data/base_files","grower_yield_rpt_2014.csv"))
fruit_15 <- fread(here("data/base_files","grower_yield_rpt_2015.csv"))
fruit_16 <- fread(here("data/base_files","grower_yield_rpt_2016.csv"))
fruit_17 <- fread(here("data/base_files","grower_yield_rpt_2017.csv"))
fruit_18 <- fread(here("data/base_files","grower_yield_rpt_2018.csv"))
fruit_decas <- list(fruit_13,
fruit_14,
fruit_15,
fruit_16,
fruit_17,
fruit_18)
fruit_decas$GTL <- NULL
fruit_decas <-
rbindlist(fruit_decas,
fill = T)
fruit_decas <- fruit_decas %>%
select(grower_id,
deliver_date,
Bog,
Rot,
Debris,
Color,
Variety)
colnames(fruit_decas) <- c("grower",
"date",
"bog",
"rot_pct",
"debris",
"color",
"variety")
View(fruit_decas)
rm(fruit_12,
fruit_13,
fruit_14,
fruit_15,
fruit_16,
fruit_17,
fruit_18)
##date manipulation
fruit_decas$date <- parse_date_time(fruit_decas$date, "mdy")
##collapsed varieties vector
other_varieties = c("OE","ORST","OH",
"OM","GR","OB",
"SN","MC","SK",
"ORHO","OS","MX",
"GD","PD")
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date)
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot_pct) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot_pct + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date)
fruit_cig <- fruit_cig %>%
##exclude rows w/ NA values in rot
filter(is.na(rot_pct) == F) %>%
##create log_rot, variety, year, and data source columns
mutate(
log_rot = log10(rot_pct + 1),
variety = as_factor("ST"),
year = 2021,
month = 10,
data_source = "cig"
) %>%
rename("yield_acre_barrel" = "yield_per_ac_barrel",
"yield_ha_barrel" = "yield_p_ha_barrel",
"yield_ac_kg" = "yield_p_ac_kg",
"yield_ac_lb" = "yield_p_ac_lb",
"site" = "Site",
"rep" = "Rep")
class(temp_precip$avg_temp_f)
#climate parameters 2003-2020----
temp_precip <- fread(here("data/base_files", "kqf_temp_precip.csv"))
class(temp_precip$avg_temp_f)
View(temp_precip)
View(pest_cig)
View(pest_decas)
source("C:/Users/user/OneDrive - University of Massachusetts/kqf_project/code/kqf_clean.R", echo=TRUE)
source("C:/Users/user/OneDrive - University of Massachusetts/kqf_project/code/kqf_clean.R", echo=TRUE)
source("C:/Users/user/OneDrive - University of Massachusetts/kqf_project/code/kqf_clean.R", echo=TRUE)
View(kqf_data_combined)
rm(fruit_temp_combined,
pest_temp_combined,
points)
library(tidyverse)
library(data.table)
library(lubridate)
require(here)
require(openxlsx)
fruit_12 <- fread(here("data/base_files","grower_yield_rpt_2012.csv"))
fruit_13 <- fread(here("data/base_files","grower_yield_rpt_2013.csv"))
fruit_14 <- fread(here("data/base_files","grower_yield_rpt_2014.csv"))
fruit_15 <- fread(here("data/base_files","grower_yield_rpt_2015.csv"))
fruit_16 <- fread(here("data/base_files","grower_yield_rpt_2016.csv"))
fruit_17 <- fread(here("data/base_files","grower_yield_rpt_2017.csv"))
fruit_18 <- fread(here("data/base_files","grower_yield_rpt_2018.csv"))
fruit_decas <- list(fruit_13,
fruit_14,
fruit_15,
fruit_16,
fruit_17,
fruit_18)
fruit_decas$GTL <- NULL
fruit_decas <-
rbindlist(fruit_decas,
fill = T)
#data file import
pest_decas <- fread(here("data/base_files","pest_use_decas.csv"))
#data file import
pest_cig <- fread(here("data/base_files", "pest_use_cig.csv"))
##define join columns
comb_pest_cols <- c("date",
"treatment",
"active_ingredient",
"grower",
"bog",
"data_source")
##full join on defined columns
pest_comb <- pest_decas %>%
full_join(pest_cig, by = comb_pest_cols, suffix = c("_decas", "_cig")) %>%
mutate(month = lubridate::month(date),
year = lubridate::year(date))
library(tidyverse)
library(data.table)
library(lubridate)
require(here)
require(openxlsx)
#data file import
fruit_12 <- fread(here("data/base_files","grower_yield_rpt_2012.csv"))
fruit_13 <- fread(here("data/base_files","grower_yield_rpt_2013.csv"))
fruit_14 <- fread(here("data/base_files","grower_yield_rpt_2014.csv"))
fruit_15 <- fread(here("data/base_files","grower_yield_rpt_2015.csv"))
fruit_16 <- fread(here("data/base_files","grower_yield_rpt_2016.csv"))
fruit_17 <- fread(here("data/base_files","grower_yield_rpt_2017.csv"))
fruit_18 <- fread(here("data/base_files","grower_yield_rpt_2018.csv"))
#combine as list
fruit_decas <- list(fruit_13,
fruit_14,
fruit_15,
fruit_16,
fruit_17,
fruit_18)
#remove duplicate column
fruit_decas$GTL <- NULL
#bind list
fruit_decas <-
rbindlist(fruit_decas,
fill = T)
#select columns
fruit_decas <- fruit_decas %>%
select(grower_id,
deliver_date,
Bog,
Rot,
Debris,
Color,
Variety)
#rename columns
colnames(fruit_decas) <- c("grower",
"date",
"bog",
"rot_pct",
"debris",
"color",
"variety")
#data file import
pest_decas <- fread(here("data/base_files","pest_use_decas.csv"))
#data file import
fruit_cig <- fread(here("data/base_files", "cig_yield_bloom.csv"))
#data file import
lw_ctrl_cig <- fread(here("data", "2021_cig_latewater_controls.csv"))
#data file import
pest_cig <- fread(here("data/base_files", "pest_use_cig.csv"))
#data file import
temp_precip <- fread(here("data/base_files", "kqf_temp_precip.csv"))
points <- fread(here("data/base_files", "kqf_points.csv"))
rm(fruit_12,
fruit_13,
fruit_14,
fruit_15,
fruit_16,
fruit_17,
fruit_18)
##date manipulation
fruit_decas$date <- parse_date_time(fruit_decas$date, "mdy")
##collapsed varieties vector
other_varieties = c("OE","ORST","OH",
"OM","GR","OB",
"SN","MC","SK",
"ORHO","OS","MX",
"GD","PD")
fruit_decas <- fruit_decas %>%
##exclude rows w/ NA values in rot
filter(is.na(rot_pct) == F) %>%
##create log_rot / year / month columns and collapse varieties by frequency
mutate(
log_rot = log10(rot_pct + 1) ,
variety = fct_collapse(variety, other = other_varieties),
year = lubridate::year(date),
month = lubridate::month(date),
##create data_source column
data_source = as.factor("decas")
) %>%
##relocate date column to [,1]
relocate(date)
##application_date (char to POSIXct)
pest_decas$date <- parse_date_time(pest_decas$application_date, "mdy")
pest_decas <- pest_decas %>%
#remove old application_date and extraneous columns
select(date,
grower,
bog,
treatment,
active_ingredient) %>%
#relocate new date column
relocate(date) %>%
#create data_source column
mutate(data_source = "decas")
fruit_cig <- fruit_cig %>%
##exclude rows w/ NA values in rot
filter(is.na(rot_pct) == F) %>%
##create log_rot, variety, year, and data source columns
mutate(
log_rot = log10(rot_pct + 1),
variety = as_factor("ST"),
year = 2021,
month = 10,
data_source = "cig"
) %>%
rename("yield_acre_barrel" = "yield_per_ac_barrel",
"yield_ha_barrel" = "yield_p_ha_barrel",
"yield_ac_kg" = "yield_p_ac_kg",
"yield_ac_lb" = "yield_p_ac_lb",
"site" = "Site",
"rep" = "Rep")
lw_ctrl_cig <- lw_ctrl_cig %>%
#rename cols based on cig_fruit names
rename("yield_acre_barrel" = "yield per acre",
"rot_pct" = "pct_rot",
"wt_p_berry" = "wt_per_berry") %>%
#create yield, data_source, site, variety, kqf, and log(rot) columns
mutate(yield_ha_barrel = yield_acre_barrel * 2.471,
yield_ac_kg = yield_acre_barrel * 45.35929257,
yield_ac_lb = yield_ac_kg * 2.20463,
data_source = "cig_lw",
site = 0,
log_rot = log10(rot_pct + 1),
variety = "ST")
pest_cig <- pest_cig %>%
##application_date (char to POSIXct)
mutate(date = parse_date_time(application_date, orders = "ymd")) %>%
#remove old application_date and select non-extraneous columns
select(date,
grower,
Bog,
treatment,
active_ingredient) %>%
#relocate new date column
relocate(date) %>%
#create data_source col
mutate(data_source = 'cig') %>%
rename("bog" = "Bog")
temp_precip <- temp_precip %>%
mutate(month = lubridate::month(date),
year = lubridate::year(date))
points <- points %>%
mutate(year = as.numeric(date_year))
##define join columns
comb_pest_cols <- c("date",
"treatment",
"active_ingredient",
"grower",
"bog",
"data_source")
##full join on defined columns
pest_comb <- pest_decas %>%
full_join(pest_cig, by = comb_pest_cols, suffix = c("_decas", "_cig")) %>%
mutate(month = lubridate::month(date),
year = lubridate::year(date))
#redefine and collapse repeated fungicides
pest_comb$active_ingredient <-
str_replace_all(
pest_comb$active_ingredient,
c(
"Manganese ethylenebisdithiocarbamate" = "EBDC",
"Mancozeb" = "EBDC",
"EDBC" = "EBDC",
"Polyoxin D Zinc Salt" = "Polyoxin D",
"Polyoxin D zinc salt" = "Polyoxin D"
)
)
#define alternative fungicides
other_ingredients <- c("Cuprous Oxide",
"Fosetyl-Al",
"Polyoxin D")
fungicide_use <- pest_comb %>%
#filter out non-fungicide treatments
filter(
active_ingredient %in% c(
"Copper Hydroxide",
"Cuprous Oxide",
"Polyoxin D",
"Chlorothalonil",
"Azoxystrobin",
"Fenbuconazole",
"Fosetyl-Al",
"EBDC",
"Ferbam"
)
) %>%
#collapse fungicides w/ <50 instances and rm original column
mutate(ingredient = fct_collapse(active_ingredient,
other = other_ingredients)) %>%
select(-active_ingredient)
pest_temp_combined <- fungicide_use %>%
full_join(temp_precip, by = c("year", "month"), suffix = c("_fungi", "_temps")) %>%
select(-date_temps) %>%
rename("date" = "date_fungi")
fruit_comb <- bind_rows(fruit_cig, fruit_decas)
fruit_temp_combined <- fruit_comb %>%
full_join(temp_precip, by = c("year", "month")) %>%
select(-date.y) %>%
rename("date" = "date.x")
#full data combine----
##define joining columns for combined data
comb_cols <- c("data_source", "date", "month", "year", "avg_temp_f", "tot_precip", "grower", "bog", "treatment")
#Join all columns on joining vec
kqf_data_combined <- fruit_temp_combined %>%
full_join(pest_temp_combined,
by = comb_cols,
suffix = c("_fruit", "_pest"))
fruit_comb <- bind_rows(fruit_cig, fruit_decas)
fruit_temp_combined <- fruit_comb %>%
full_join(temp_precip, by = c("year", "month")) %>%
select(-date.y) %>%
rename("date" = "date.x")
fruit_comb <- bind_rows(fruit_cig, fruit_decas)
fruit_temp_combined <- fruit_comb %>%
full_join(temp_precip, by = c("year", "month")) %>%
select(-date.y) %>%
rename("date" = "date.x")
##define joining columns for combined data
comb_cols <- c("data_source", "date", "month", "year", "avg_temp_f", "tot_precip", "grower", "bog", "treatment")
#Join all columns on joining vec
kqf_data_combined <- fruit_temp_combined %>%
full_join(pest_temp_combined,
by = comb_cols,
suffix = c("_fruit", "_pest"))
View(fruit_temp_combined)
View(pest_temp_combined)
##define joining columns for combined data
comb_cols <- c("data_source", "date", "month", "year", "avg_temp_f", "tot_precip", "grower", "bog", "treatment")
#Join all columns on joining vec
# kqf_data_combined <- fruit_temp_combined %>%
#   full_join(pest_temp_combined,
#             by = comb_cols,
#             suffix = c("_fruit", "_pest"))
##factor coercion
kqf_data_combined$variety <- as_factor(kqf_data_combined$variety)
kqf_data_combined$site <- as_factor(kqf_data_combined$site)
kqf_data_combined$rep <- as_factor(kqf_data_combined$rep)
kqf_data_combined$data_source <- as_factor(kqf_data_combined$data_source)
kqf_data_combined$treatment <- as_factor(kqf_data_combined$treatment)
kqf_data_combined$ingredient <- as_factor(kqf_data_combined$ingredient)
#join kqf points column
kqf_data_combined <- kqf_data_combined %>%
full_join(points, by = c("year")) %>%
select(-date_year)
##define joining columns for combined data
comb_cols <- c("data_source", "date", "month", "year", "avg_temp_f", "tot_precip", "grower", "bog")
#Join all columns on joining vec
kqf_data_combined <- fruit_temp_combined %>%
full_join(pest_temp_combined,
by = comb_cols,
suffix = c("_fruit", "_pest"))
##factor coercion
kqf_data_combined$variety <- as_factor(kqf_data_combined$variety)
kqf_data_combined$site <- as_factor(kqf_data_combined$site)
kqf_data_combined$rep <- as_factor(kqf_data_combined$rep)
kqf_data_combined$data_source <- as_factor(kqf_data_combined$data_source)
kqf_data_combined$treatment <- as_factor(kqf_data_combined$treatment)
kqf_data_combined$ingredient <- as_factor(kqf_data_combined$ingredient)
#join kqf points column
kqf_data_combined <- kqf_data_combined %>%
full_join(points, by = c("year")) %>%
select(-date_year)
